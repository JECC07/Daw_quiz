-- Base de datos: quiz_app_db
CREATE DATABASE IF NOT EXISTS quiz_app_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE quiz_app_db;

--
-- Estructura de tabla para la tabla profesores
--
DROP TABLE IF EXISTS profesores;
CREATE TABLE profesores (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre_completo VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla cuestionarios
--
DROP TABLE IF EXISTS cuestionarios;
CREATE TABLE cuestionarios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  profesor_id INT NOT NULL,
  titulo VARCHAR(255) NOT NULL,
  descripcion TEXT,
  es_publico BOOLEAN DEFAULT FALSE,
  fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  fecha_modificacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (profesor_id) REFERENCES profesores(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla preguntas
--
DROP TABLE IF EXISTS preguntas;
CREATE TABLE preguntas (
  id INT AUTO_INCREMENT PRIMARY KEY,
  cuestionario_id INT NOT NULL,
  texto_pregunta TEXT NOT NULL,
  tiempo_limite_seg INT NOT NULL DEFAULT 20,
  url_media VARCHAR(255) NULL,
  orden INT NOT NULL,
  FOREIGN KEY (cuestionario_id) REFERENCES cuestionarios(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla opciones
--
DROP TABLE IF EXISTS opciones;
CREATE TABLE opciones (
  id INT AUTO_INCREMENT PRIMARY KEY,
  pregunta_id INT NOT NULL,
  texto_opcion VARCHAR(255) NOT NULL,
  es_correcta BOOLEAN NOT NULL DEFAULT FALSE,
  FOREIGN KEY (pregunta_id) REFERENCES preguntas(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla partidas
--
DROP TABLE IF EXISTS partidas;
CREATE TABLE partidas (
  id INT AUTO_INCREMENT PRIMARY KEY,
  cuestionario_id INT NOT NULL,
  pin_acceso VARCHAR(8) NOT NULL UNIQUE,
  modo_juego ENUM('individual', 'grupo') NOT NULL,
  estado ENUM('esperando', 'en_progreso', 'finalizada') NOT NULL DEFAULT 'esperando',
  fecha_inicio TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (cuestionario_id) REFERENCES cuestionarios(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla participantes
--
DROP TABLE IF EXISTS participantes;
CREATE TABLE participantes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  partida_id INT NOT NULL,
  nombre_usuario VARCHAR(50) NOT NULL,
  puntuacion_total INT DEFAULT 0,
  FOREIGN KEY (partida_id) REFERENCES partidas(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Estructura de tabla para la tabla respuestas_participantes
--
DROP TABLE IF EXISTS respuestas_participantes;
CREATE TABLE respuestas_participantes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  participante_id INT NOT NULL,
  pregunta_id INT NOT NULL,
  opcion_id INT NOT NULL,
  tiempo_respuesta_ms INT NOT NULL,
  puntuacion_obtenida INT NOT NULL,
  fecha_respuesta TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (participante_id) REFERENCES participantes(id) ON DELETE CASCADE,
  FOREIGN KEY (pregunta_id) REFERENCES preguntas(id) ON DELETE CASCADE,
  FOREIGN KEY (opcion_id) REFERENCES opciones(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;